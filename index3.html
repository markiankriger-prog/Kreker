<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Racing Levels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:#111; }
canvas { display:block; margin:auto; background:#555; }

#menu {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.8);
    color: white;
    font-family: Arial;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

button, select {
    padding: 10px 20px;
    font-size: 16px;
}
#ui {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    font-family: Arial;
    font-size: 18px;
}
</style>
</head>
<body>

<div id="menu">
    <h2>üèéÔ∏è –ì–û–ù–ö–ò</h2>

    –ú–∞—à–∏–Ω–∞:
    <select id="carSelect">
        <option value="red">–ß–µ—Ä–≤–æ–Ω–∞</option>
        <option value="blue">–°–∏–Ω—è</option>
        <option value="yellow">–ñ–æ–≤—Ç–∞</option>
    </select>

    –®–≤–∏–¥–∫—ñ—Å—Ç—å:
    <select id="speedSelect">
        <option value="6">–ü–æ–≤—ñ–ª—å–Ω–∞</option>
        <option value="8" selected>–°–µ—Ä–µ–¥–Ω—è</option>
        <option value="10">–®–≤–∏–¥–∫–∞</option>
    </select>

    <button onclick="startGame()">‚ñ∂ –ü–æ—á–∞—Ç–∏</button>
</div>

<div id="ui">
–†—ñ–≤–µ–Ω—å: <span id="level">1</span><br>
–û—á–∫–∏: <span id="score">0</span><br>
–†–µ–∫–æ—Ä–¥: <span id="best">0</span><br>
<button onclick="restartLevel()">üîÅ –†—ñ–≤–µ–Ω—å —Å–ø–æ—á–∞—Ç–∫—É</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let car, obstacles, score, level, speed, turn;
let left=false, right=false;
let best = localStorage.getItem("best") || 0;
document.getElementById("best").textContent = best;

// ‚¨ÖÔ∏è‚û°Ô∏è –ö–õ–ê–í–Ü–ê–¢–£–†–ê
document.addEventListener("keydown",e=>{
    if(e.code==="ArrowLeft") left=true;
    if(e.code==="ArrowRight") right=true;
});
document.addEventListener("keyup",e=>{
    if(e.code==="ArrowLeft") left=false;
    if(e.code==="ArrowRight") right=false;
});

// üì± –¢–ê–ß
document.addEventListener("touchstart",e=>{
    if(e.touches[0].clientX < window.innerWidth/2) left=true;
    else right=true;
});
document.addEventListener("touchend",()=>left=right=false);

function startGame(){
    document.getElementById("menu").style.display="none";
    level=1;
    initLevel();
    loop();
}

function restartLevel(){
    initLevel();
}

function initLevel(){
    obstacles=[];
    score=0;
    turn=0;

    speed = +document.getElementById("speedSelect").value + level;
    let color = document.getElementById("carSelect").value;

    car = {
        x: canvas.width/2 - 25,
        y: canvas.height - 120,
        w: 50,
        h: 80,
        color
    };

    document.getElementById("level").textContent = level;
    document.getElementById("score").textContent = score;
}

function spawnObstacle(){
    obstacles.push({
        x: canvas.width/2 + turn + (Math.random()*200-100),
        y: -100,
        w: 50,
        h: 80
    });
}

function hit(a,b){
    return a.x<b.x+b.w && a.x+a.w>b.x &&
           a.y<b.y+b.h && a.y+a.h>b.y;
}

function drawRoad(){
    ctx.fillStyle="#444";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle="white";
    ctx.lineWidth=5;
    ctx.setLineDash([40,40]);
    ctx.beginPath();
    ctx.moveTo(canvas.width/2+turn,0);
    ctx.lineTo(canvas.width/2+turn,canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
}

function loop(){
    drawRoad();

    // –ø–æ–≤–æ—Ä–æ—Ç–∏ –¥–æ—Ä–æ–≥–∏
    turn += Math.sin(Date.now()/800)*0.8;

    if(left) car.x -= 7;
    if(right) car.x += 7;

    car.x += turn*0.15;
    car.x = Math.max(0,Math.min(canvas.width-car.w,car.x));

    ctx.fillStyle=car.color;
    ctx.fillRect(car.x,car.y,car.w,car.h);

    if(Math.random()<0.03) spawnObstacle();

    obstacles.forEach((o,i)=>{
        o.y += speed;
        ctx.fillStyle="blue";
        ctx.fillRect(o.x,o.y,o.w,o.h);

        if(hit(car,o)){
            alert("üí• –ê–≤–∞—Ä—ñ—è!");
            restartLevel();
        }

        if(o.y>canvas.height){
            obstacles.splice(i,1);
            score++;
            document.getElementById("score").textContent=score;

            if(score>best){
                best=score;
                localStorage.setItem("best",best);
                document.getElementById("best").textContent=best;
            }

            if(score%20===0){
                level++;
                initLevel();
            }
        }
    });

    requestAnimationFrame(loop);
}
</script>

</body>
</html>
